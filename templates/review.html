<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <title>가스 스테이션</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap"
      rel="stylesheet"
    />
    <title>Document</title>
    <style>
      .sign-out {
        height: 100px;
      }
      /* 지도와 리스트를 감싸는 div */
      .container {
        display: flex;
        flex-wrap: wrap;
      }

      /* 지도 영역 */
      #map {
        width: 60%;
        height: 500px;
      }

      /* 리스트 영역 */
      #list {
        width: 40%;
        height: 500px;
        /* overflow-y: auto; */
      }

      /* 리스트 아이템 */
      li {
        padding: 10px;
        border-bottom: 1px solid #ccc;
      }

      /* 리스트 아이템 마우스 호버 */
      li:hover {
        background-color: #f5f5f5;
      }
      /* 로그아웃 */
      a {
        position: absolute;
        top: 0;
        right: 0;
        margin: 10px;
      }
      .review {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        width: 100%;
      }
      .review > button {
        margin-left: 20px;
        width: 100px;
      }
      .comment-write {
        margin-left: 10px;
        width: 100%;
      }
    </style>
    <script>
      $(document).ready(function () {
        hey();
      });
      function save_comment() {
        let comment = $("#exampleFormControlTextarea1").val();
        //id 정보를 어떻게 받아올 수 있을까?
        //let id = $
        let star = $("#star").val();

        let today = new Date();
        let year = today.getFullYear();
        let month = ("0" + (today.getMonth() + 1)).slice(-2);
        let day = ("0" + today.getDate()).slice(-2);
        let dateString = year + "-" + month + "-" + day;
        console.log(dateString);

        let formData = new FormData();
        formData.append("comment_give", comment);
        //id정보 해결시 주석해제
        //formData.append("id_give", id);
        formData.append("star_give", star);
        formData.append("date_give", dateString);

        fetch("/test", { method: "POST", body: formData })
          .then((res) => res.json())
          .then((data) => {
            console.log(data);
            alert(data["msg"]);
          });
        window.location.reload();
      }
      function hey() {
        fetch("/test")
          .then((res) => res.json())
          .then((data) => {
            $("#comment").empty();
            let rows = data["result"];
            rows.forEach((a) => {
              let comment = a["comment"];
              let star = a["star"];
              let date = a["date"];

              let star_repeat = "⭐".repeat(star);

              let temp_html = `<a href="#" class="list-group-item list-group-item-action">
                                  <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1 star">${star_repeat}</h5>
                                    <small class="date">${date}</small>
                                  </div>
                                  <div class="d-flex review_container">
                                    <p class="mb-1 comment">${comment}</p>
                                  </div>
                                  <div class="d-flex">
                                    <small>작성자: </small>
                                    <small class="writer">바나나우유맛있다</small>
                                  </div>
                                  <button
                                  onclick="delete_comment('${comment}')"
                                  type="button"
                                  class="btn btn-secondary"
                                >
                                  삭제
                                </button>
                                </a>`;
              $("#comment").append(temp_html);
            });
            //console.log(data);
            //alert(data["result"]);
          });
      }
      function delete_comment(comment) {
        let formData = new FormData();
        formData.append("comment_give", comment);
        fetch("/delete", { method: "POST", body: formData })
          .then((res) => res.json())
          .then((data) => {
            //console.log(data);
            //alert(data["msg"]);
          });
        window.location.reload();
      }
    </script>
  </head>
  <body>
    <div class="sign-out">
      <a style="text-decoration: none" href="">로그아웃</a>
    </div>

    <!-- 지도와 리스트를 감싸는 div -->
    <div class="container">
      <!-- 지도 영역 -->
      <div id="map"></div>
      <!-- 리스트 영역 -->
      <div id="list">
        <div id="comment" class="list-group">
          <a href="#" class="list-group-item list-group-item-action">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1 star">⭐⭐⭐⭐⭐</h5>
              <small class="date">2023-02-18</small>
            </div>
            <div class="d-flex review_container">
              <p class="mb-1 comment">여기 주유 맛집ㅋㅋㅋ</p>
            </div>
            <div class="d-flex">
              <small>작성자: </small>
              <small class="writer">바나나우유맛있다</small>
            </div>
            <button
              onclick="delete_comment()"
              type="button"
              class="btn btn-secondary"
            >
              삭제
            </button>
          </a>
          <a href="#" class="list-group-item list-group-item-action">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1 star">⭐⭐⭐⭐⭐</h5>
              <small class="date">2023-03-05</small>
            </div>
            <div class="d-flex review_container">
              <p class="mb-1 comment">금손으로 세차하시네요</p>
            </div>
            <div class="d-flex">
              <small>작성자: </small>
              <small class="writer">초코우유맛있다</small>
            </div>
          </a>
          <a href="#" class="list-group-item list-group-item-action">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1 star">⭐⭐⭐⭐⭐</h5>
              <small class="date">2023-03-28</small>
            </div>
            <div class="d-flex review_container">
              <p class="mb-1 comment">ㅋㅋㅋ차에 기스 실화냐?</p>
            </div>
            <div class="d-flex">
              <small>작성자: </small>
              <small class="writer">딸기우유맛있다</small>
            </div>
          </a>
        </div>
        <div class="comment-write">
          <div class="mb-3">
            <textarea
              class="form-control"
              id="exampleFormControlTextarea1"
              rows="3"
              placeholder="Comment"
            ></textarea>
          </div>
          <div class="review" style="width: 60%">
            <select
              id="star"
              class="form-select"
              aria-label="Default select example"
            >
              <option selected>별점</option>
              <option value="1">⭐</option>
              <option value="2">⭐⭐</option>
              <option value="3">⭐⭐⭐</option>
              <option value="4">⭐⭐⭐⭐</option>
              <option value="5">⭐⭐⭐⭐⭐</option>
            </select>
            <button
              onclick="save_comment()"
              type="button"
              class="btn btn-secondary"
            >
              등록
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Google Maps API를 사용하여 지도를 표시 -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
    <script>
      function initMap() {
        var center = { lat: 37.5665, lng: 126.978 }; // 지도 중심 좌표
        var map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12, // 지도 확대/축소 레벨
          center: center, // 지도 중심 좌표
        });
      }
    </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
    ></script>
  </body>
</html>
